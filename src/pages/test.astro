---
import Layout from "@/layouts/Layout.astro";
---

<Layout>
  <main>
    <h1>Test page</h1>
    You found the test page! Use this to test the results of queries

    <div id="buttonContainer"></div>
    <div id="results"></div>
  </main>
</Layout>
<script>
  import { allStats } from "@/lib/stats";
  import { statsDb } from "@/lib/stats-db";
  import { Player } from "@/lib/player";

  const container = document.querySelector("div#buttonContainer");
  const results = document.querySelector("div#results");

  allStats.forEach((stat) => {
    const button = document.createElement("button");
    button.innerText = stat.name;
    button.addEventListener("click", async () => {
      if (results === null) return;
      results.innerHTML = "";

      for (const row of stat.evaluate(statsDb, {})) {
        const player = new Player(row.playerId);

        const div = document.createElement("div");
        div.style.display = "flex";
        div.style.alignItems = "center";
        div.style.gap = "8px";
        div.style.marginBottom = "4px";

        const avatarUrl = await player.getAvatarUrl();
        if (avatarUrl) {
          const img = document.createElement("img");
          img.src = avatarUrl;
          img.alt = "";
          img.style.width = "32px";
          img.style.height = "32px";
          img.style.borderRadius = "50%";
          img.style.objectFit = "cover";
          div.appendChild(img);
        }

        const text = document.createElement("span");
        text.innerText = `${player.getName()}: ${row.value}`;

        div.appendChild(text);
        results.appendChild(div);
      }
    });
    container?.appendChild(button);
  });
</script>
